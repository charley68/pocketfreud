<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Home - PocketFreud</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body class="{{ 'test-env' if ENV == 'test' else 'prod-env' }}">


  <!-- ✅ Header -->
  <div class="top-bar authenticated">
    <img src="{{ url_for('static', filename='logo.png') }}" alt="PocketFreud Logo" class="logo">
    <div class="branding">
      <h1 class="app-title">PocketFreud</h1>
    </div>
    <nav class="nav-buttons">
        <a class="logout-button" href="{{ url_for('logout') }}">Logout</a>
    </nav>
  </div>

  <!-- ✅ Main Content -->
  <div class="container">
    <h1>Hi {{ username }}, how are you feeling today?</h1>

    <div class="emojis">
        <span class="emoji-button" onclick="selectMood('happy')">😊</span>
        <span class="emoji-button" onclick="selectMood('neutral')">😐</span>
        <span class="emoji-button" onclick="selectMood('sad')">😟</span>
        <span class="emoji-button" onclick="selectMood('anxious')">😕</span>
        <span class="emoji-button" onclick="selectMood('angry')">😠</span>
      </div>
      

    <form action="{{ url_for('journal') }}" method="get">
      <button type="submit" class="menu-button">📝 Journal Entry</button>
    </form>

    <button class="menu-button" onclick="comingSoon('Goals')">🎯 Today’s Goal</button>

    <form action="{{ url_for('chat') }}" method="get">
      <button type="submit" class="menu-button">💬 Talk to PocketFreud</button>
    </form>
  </div>

    <!-- ✅ Bottom Nav -->
    <div class="bottom-nav">
      <a href="{{ url_for('journal_calendar') }}"><div><i>📓</i><div>Journal</div></div></a>
      <a href="#"><div><i>📊</i><div>Insights</div></div></a>
      <div class="more-container">
        <div class="more-button" onclick="toggleMoreMenu()">
          <i>⋯</i>
          <div>More</div>
        </div>
      </div>
    </div>

    <div class="more-menu" id="moreMenu" onclick="event.stopPropagation()">
      <a href="{{ url_for('profile') }}">👤 Profile</a>
    </div>

  <script>
    let moreJustOpened = false;

    function toggleMoreMenu() {
      const menu = document.getElementById('moreMenu');
      const isVisible = menu.classList.contains('show');

      if (!isVisible) {
        menu.classList.add('show');
        moreJustOpened = true;
        setTimeout(() => { moreJustOpened = false; }, 200);
      } else {
        menu.classList.remove('show');
      }
    }

    window.addEventListener('click', function (e) {
      const menu = document.getElementById('moreMenu');
      const button = document.querySelector('.more-button');

      if (!button.contains(e.target) && !moreJustOpened) {
        menu.classList.remove('show');
      }
    });

    function selectMood(mood) {
      const note = prompt("Want to add a note about how you're feeling?");
      fetch('/log_mood', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          mood: mood,
          note: note || '',
          timestamp: new Date().toISOString()
        })
      }).then(response => {
        if (response.ok) {
        } else {
          alert("Failed to save mood.");
        }
      });
    }

    function comingSoon(feature) {
        alert(`${feature} is coming soon!`);
    }

  </script>
  

</body>
</html>
