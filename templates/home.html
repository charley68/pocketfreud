<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Home - PocketFreud</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body class="{{ 'test-env' if ENV == 'test' else 'prod-env' }}">

  <!-- ✅ Header -->
  <div class="top-bar authenticated">
    <img src="{{ url_for('static', filename='logo.png') }}" alt="PocketFreud Logo" class="logo">
    <div class="branding">
      <h1 class="app-title">PocketFreud</h1>
    </div>
    <nav class="nav-buttons">
        <a class="logout-button" href="{{ url_for('logout') }}">Logout</a>
    </nav>
  </div>

  <!-- ✅ Main Content -->
  <div class="container">
    <h1>Hi {{ username }}, how are you feeling today?</h1>

    <div class="emojis">
        <span class="emoji-button" onclick="logMood('happy')">😊</span>
        <span class="emoji-button" onclick="logMood('neutral')">😐</span>
        <span class="emoji-button" onclick="logMood('sad')">😟</span>
        <span class="emoji-button" onclick="logMood('anxious')">😕</span>
        <span class="emoji-button" onclick="logMood('angry')">😠</span>
      </div>
      
      <div id="happyModal" class="modal-overlay">
        <div class="modal">
          <h2>Glad you're feeling good! 🎉</h2>
          <div class="modal-buttons">
            <button onclick="closeHappyModal()">Close</button>
          </div>
        </div>
      </div>
      
      <div id="supportModal" class="modal-overlay">
        <div class="modal">
          <h2>Would you like to talk to PocketFreud?</h2>
          <div class="modal-buttons">
            <button onclick="goToChat()">Chat Now</button>
            <button onclick="goToJournal()">Write in Journal</button>
            <button onclick="closeSupportModal()">I'm good thanks!</button>
          </div>
        </div>
      </div>
      

    <div class="home-buttons">
      <a href="{{ url_for('journal') }}" class="menu-button">📝 Journal Entry</a>
      <button class="menu-button disabled" onclick="comingSoon('Goals')">🎯 Today’s Goal</button>
      <a href="{{ url_for('chat') }}" class="menu-button">💬 Talk to PocketFreud</a>
  </div>

  </div>

    <!-- ✅ Bottom Nav -->
    <div class="bottom-nav">
      <a href="{{ url_for('journal_calendar') }}"><div><i>📓</i><div>Journal</div></div></a>
      <a class="nav-disabled"><div><i>📊</i><div>Insights</div></div></a>
      <div class="more-container">
        <div class="more-button" onclick="toggleMoreMenu()">
          <i>⋯</i>
          <div>More</div>
        </div>
      </div>
    </div>

    <div class="more-menu" id="moreMenu" onclick="event.stopPropagation()">
      <a href="{{ url_for('profile') }}">👤 Profile</a>
    </div>

  <script>
    let moreJustOpened = false;

    function toggleMoreMenu() {
      const menu = document.getElementById('moreMenu');
      const isVisible = menu.classList.contains('show');

      if (!isVisible) {
        menu.classList.add('show');
        moreJustOpened = true;
        setTimeout(() => { moreJustOpened = false; }, 200);
      } else {
        menu.classList.remove('show');
      }
    }

    window.addEventListener('click', function (e) {
      const menu = document.getElementById('moreMenu');
      const button = document.querySelector('.more-button');

      if (!button.contains(e.target) && !moreJustOpened) {
        menu.classList.remove('show');
      }
    });


    function logMood(mood) {
      fetch('/log_mood', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ mood: mood })
      }).then(response => {
        if (response.ok) {
          if (mood === 'happy') {
            showHappyModal();
          } else {
            showSupportModal(mood);
          }
        } else {
          alert('Something went wrong. Please try again.');
        }
      });
    }

    // Modal handlers
    function showHappyModal() {
      document.getElementById('supportModal').classList.add('show');
    }

    function closeHappyModal() {
      document.getElementById('supportModal').classList.remove('show');
    }

    function showSupportModal(mood) {

      const modalTitle = document.querySelector('#supportModal .modal h2');
      const formattedMood = mood.charAt(0).toUpperCase() + mood.slice(1); // Capitalize
      modalTitle.textContent = `Today you feel ${formattedMood}. Want to talk or write about it?`;

      document.getElementById('supportModal').classList.add('show');
    }

    function goToChat() {
      window.location.href = '/chat';
    }

    function goToJournal() {
      window.location.href = '/journal';
    }

    function comingSoon(feature) {
        alert(`${feature} is coming soon!`);
    }

    function closeSupportModal() {
       document.getElementById('supportModal').classList.remove('show'); // ✅ matches how it was shown
    }
  </script>
  

</body>
</html>
